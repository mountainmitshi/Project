---
title: "Project_3"
author: "Sarah Eiben, Michelle Baumgartner, Deni Hodzic"
date: '2022-06-14'
output: html_document
---

```{r}
suppressPackageStartupMessages({
  library(GenomicRanges)
  library(epiwraps)
  library(ggplot2)
  library(rGREAT)
  library(AnnotationHub)
  library(Rsubread)
  library(rtracklayer)
  library(Biostrings)
  library(Rfastp)
  library(ensembldb)
  library(bsseq)
  library(BiocParallel)
  library(edgeR)
  library(DMRcate)
})
```

# Region access

Using the functions regionOverlaps and regionUpset we analyse the access of the DNA by the different CREB family members.

First we do everything just for Chromosome 1 to get an idea, then we move on to the whole genome (project part 6).

## Restricting all of the CREB family memeber peaks to just chromosome 1

```{r}
# CREB1
peaks_creb1_chr1 <- peaks_creb1[seqnames(peaks_creb1)=="chr1"]
# CREB3
peaks_creb3_chr1 <- peaks_creb3[seqnames(peaks_creb3)=="chr1"]
# CREB3L1
peaks_creb3l1_chr1 <- peaks_creb3l1[seqnames(peaks_creb3l1)=="chr1"]
# CREB5
peaks_creb5_chr1 <- peaks_creb5[seqnames(peaks_creb5)=="chr1"]
```

## Getting an idea of the peaks in chromosome 1

Should we do this??

Using just the strongest peaks.

```{r}
#look at how many peaks there are
length(peaks_creb1_chr1)
head(peaks_creb1_chr1)
#My peaks for some reason doesn't have the qValue?
strong_peaks_creb1 <- peaks_creb1_chr1[peaks_creb1_chr1$score>median(peaks_creb1_chr1$score)]
#extend shows you a little more area around the peak, the resolution is 20, specify the regions you want to analyse
peakSignals_creb1_chr1 <- signal2Matrix("signal_pv_creb/signal_pv_creb1", regions=strong_peaks_creb1, extend=2000, w=20)
class(peakSignals_creb1_chr1[[1]])
#the data itself is a big matrix, let's look at it
peakSignals_creb1_chr1[[1]][1:5, 1:5]
plotEnrichedHeatmaps(peakSignals_creb1_chr1, raster_by_magick=FALSE)
```

## Creating a regionOverlap and a regionUpset for all CREB family members for chromosome 1

First we create an Overlap of the peaks of chromosome 1 of all CREB family members and an Upsetplot of the same regions.

Look at lecture 5 code for this!

```{r}
listofRegions <- list(creb1=peaks_creb1_chr1, creb3=peaks_creb3_chr1, creb3l1=peaks_creb3l1_chr1, creb5=peaks_creb5_chr1)
regionOverlaps(listofRegions)
regionUpset(listofRegions)
```

## Restricting to CREB1 sites

Here we tried out how the upsetplot changes when we restrict it to CREB1.

```{r}
regionUpset(listofRegions, reference = peaks_creb1_chr1)
```

## Restricting to CREB3 sites

Here we tried out how the upsetplot changes when we restrict it to CREB3.

```{r}
regionUpset(listofRegions, reference = peaks_creb3_chr1)
```

## Restricting to CREB3L1 sites

Here we tried out how the upsetplot changes when we restrict it to CREB3L1.

```{r}
regionUpset(listofRegions, reference = peaks_creb3l1_chr1)
```
## Restricting to CREB5 sites
Here we tried out how the upsetplot changes when we restrict it to CREB5.

```{r}
regionUpset(listofRegions, reference = peaks_creb5_chr1)
```

# How do these plots make sense?

We can see in the RegionOverlap plot that CREB3L1 and CREB1 have the most overlapping regions followed by CREB3L1 and CREB3, then CREB1 and CREB3. CREB5 does not seem to overlap much with any of the other regions.

In the unrestricted RegionUpset these findings are reproduced and you can see additionally that CREB1, CREB3L1 and CREB3 have many common intersections that are shared amongst the 3 of them.
CREB1 and CREB3L1 share by far the most intersections.

When restricting the RegionUpset plot to CREB1 you can see that it shares most intersections with CREB3L1 followed by CREB3. The intersection number of CREB3L1, CREB1 and CREB3 is again shown to be quite high.

Restriction to CREB3 shows that intersections with CREB3L1 are highest, followed by CREB1 and then CREB5.

The order intersections of CREB3L1 is from high to low: CREB1, CREB3, CREB5, where the intersections with CREB5 are almost inexistent.

CREB5 seems to have very few intersections with the other family members but most with CREB3.

Intersection size is generally decreasing in the following order: CREB3L1, CREB1, CREB3, CREB5.



```{r}
sessionInfo()
```
